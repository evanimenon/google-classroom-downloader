<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Classroom File Downloader</title>
<link rel="icon" href="/docs/gcdicon.png">
<script src="https://cdn.tailwindcss.com"></script>
<style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
body { font-family: 'Inter', system-ui; background:#f7f9fc; }
</style>
</head>

<body class="text-gray-800">

<header class="bg-white border-b p-5 flex justify-between items-center">
  <h1 class="text-xl font-bold text-indigo-600">Classroom File Downloader</h1>
</header>

<main class="max-w-6xl mx-auto p-6">

<!-- Terminal -->
<div class="bg-gray-900 rounded-xl shadow-lg overflow-hidden mb-10">
  <div class="bg-gray-800 px-4 py-2 text-xs text-gray-300">system_status.log</div>
  <div class="p-4 font-mono text-green-400 text-sm space-y-1" id="terminal">
    <p>> System initialized...</p>
    <p>> Ready to fetch course data.</p>
  </div>
</div>

<section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
{% for c in courses %}
<div class="bg-white border rounded-xl p-5 shadow-sm hover:shadow-md transition flex flex-col justify-between">
  <div>
    <h3 class="font-bold text-lg mb-1">{{ c.name }}</h3>
    <span class="inline-block text-xs px-3 py-1 rounded-full 
      {% if c.courseState == 'ACTIVE' %}
      bg-green-100 text-green-700
      {% else %}
      bg-gray-200 text-gray-500
      {% endif %}">
      {{ c.courseState }}
    </span>
  </div>
  <button onclick="openDrawer('{{ c.id }}','{{ c.name }}')"
    class="mt-5 py-2 rounded-lg bg-indigo-50 text-indigo-600 hover:bg-indigo-100 transition">
    Manage Files
  </button>
</div>
{% endfor %}
</section>

<!-- Credit -->
<div class="mt-12 text-center text-sm text-gray-400">
  Made by <span class="font-semibold text-gray-500">Evani Menon</span>
</div>
</main>

<!-- Drawer -->
<div id="drawerOverlay" onclick="closeDrawer()" class="fixed inset-0 bg-black/40 hidden z-40"></div>
<div id="drawer" class="fixed right-0 top-0 h-full w-full max-w-md bg-white shadow-2xl z-50 transform translate-x-full transition">

<div class="p-6 border-b flex justify-between items-center">
  <div>
    <h2 id="drawerTitle" class="font-bold text-xl"></h2>
    <p class="text-sm text-gray-500">Select files to include</p>
  </div>
  <button onclick="closeDrawer()" class="text-3xl text-gray-400">&times;</button>
</div>

<form action="/download" method="post" class="flex flex-col h-full">
<input type="hidden" name="course_ids" id="activeCourseId">

<div id="fileList" class="flex-1 overflow-y-auto p-6 space-y-3 text-sm text-gray-700"></div>

<div class="p-6 border-t">
<button type="submit" class="w-full py-3 rounded-xl bg-indigo-600 text-white font-semibold hover:bg-indigo-700">
Download Selected Files
</button>
</div>
</form>
</div>

<script>
const terminal = document.getElementById("terminal");
function logToTerminal(m){terminal.innerHTML+=`<p>> ${m}</p>`}

async function openDrawer(id,name){
 document.getElementById("drawerTitle").innerText=name;
 document.getElementById("activeCourseId").value=id;
 document.getElementById("fileList").innerHTML="<p class='text-center text-gray-400'>Loading...</p>";
 document.getElementById("drawer").classList.remove("translate-x-full");
 document.getElementById("drawerOverlay").classList.remove("hidden");
 logToTerminal("Opening course: "+name);

 const r = await fetch(`/api/courses/${id}/files`);
 const f = await r.json();
 document.getElementById("fileList").innerHTML = f.map(x=>`
 <label class="block p-3 border rounded-lg hover:bg-gray-50">
  <input type="checkbox" checked name="file_ids" value="${x.id}">
  ${x.name}
 </label>`).join("");
 logToTerminal(`Found ${f.length} files available for download.`);
}
function closeDrawer(){
 document.getElementById("drawer").classList.add("translate-x-full");
 document.getElementById("drawerOverlay").classList.add("hidden");
}
</script>
</body>
</html>
